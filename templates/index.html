<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RDR Hosting Reminder</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f8fafc;
      --surface:#ffffff;
      --surface2:#f1f5f9;
      --text:#0f172a;
      --text-secondary:#475569;
      --primary:#8b5cf6;
      --primary-hover:#7c3aed;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;
      --border:#e2e8f0;
      --radius:14px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Inter',sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.55;
      min-height:100vh;
      padding-bottom:105px;
    }
    .container{max-width:1240px;margin:0 auto;padding:1.1rem 1rem}

    /* ===== Topbar ===== */
    .topbar{
      display:flex;align-items:center;justify-content:space-between;
      gap:10px;
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:16px;
      padding:0.75rem 0.9rem;
      box-shadow:0 4px 16px rgba(15,23,42,0.05);
      position:sticky; top:10px; z-index:50;
      backdrop-filter: blur(4px);
    }
    .top-left{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:11px;display:grid;place-items:center;
      background:linear-gradient(135deg,#8b5cf6,#ec4899);
      color:white;font-weight:800;
      box-shadow:0 7px 18px rgba(139,92,246,.30);
      font-size:0.95rem;
    }
    .title-wrap h1{
      font-size:1.25rem;font-weight:700;line-height:1.1;
      background:linear-gradient(to right,#8b5cf6,#ec4899);
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
    }
    .title-wrap .subtitle{
      font-size:0.8rem;color:var(--text-secondary);
    }

    .top-right{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
    .badge{
      display:inline-flex;align-items:center;gap:6px;
      background:var(--surface2);
      border:1px solid var(--border);
      padding:5px 9px;border-radius:999px;font-size:12px;font-weight:600;
      color:var(--text-secondary);
      white-space:nowrap;
    }
    .logout{
      background:linear-gradient(135deg,#ef4444,#dc2626);
      color:white;border:none;cursor:pointer;
      padding:6px 10px;border-radius:10px;font-weight:700;font-size:12px;
      text-decoration:none;
      transition:.12s ease;
      display:inline-flex;align-items:center;gap:6px;
      box-shadow:0 6px 12px rgba(239,68,68,.18);
    }
    .logout:hover{filter:brightness(1.05);transform:translateY(-1px)}

    header{text-align:center;margin:1.4rem 0 1rem}
    header .subtitle{color:var(--text-secondary);font-size:0.92rem;margin-top:4px}

    .stats-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:.8rem;margin:1.1rem 0 1.7rem;
    }
    .stat-card{
      background:var(--surface);border-radius:14px;padding:1.05rem .9rem;
      border:1px solid var(--border);box-shadow:0 3px 12px rgba(15,23,42,0.05);
      text-align:center;
    }
    .stat-value{font-size:2rem;font-weight:700;color:var(--primary)}
    .stat-label{color:var(--text-secondary);font-size:0.82rem;margin-top:0.25rem}

    .card{
      background:var(--surface);border-radius:16px;padding:1.25rem;margin-bottom:1.1rem;
      border:1px solid var(--border);box-shadow:0 3px 14px rgba(15,23,42,0.05);
    }

    .card-head{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-bottom:.8rem;
    }
    .card-head h2{font-size:1.1rem}

    .form-grid{
      display:grid;grid-template-columns:1fr;gap:.7rem;margin-bottom:1rem
    }
    input{
      width:100%;padding:0.8rem 0.85rem;background:#fff;border:1px solid var(--border);
      border-radius:12px;font-size:0.95rem;
    }
    input:focus{
      outline:none;border-color:var(--primary);
      box-shadow:0 0 0 4px rgba(139,92,246,0.12)
    }

    /* ===== Buttons (pro + icons) ===== */
    .btn{
      appearance:none;border:none;cursor:pointer;
      font-weight:700;letter-spacing:.2px;
      padding:0.7rem 1rem;border-radius:11px;
      transition:.15s ease;
      display:inline-flex;align-items:center;justify-content:center;gap:7px;
      box-shadow:0 6px 14px rgba(15,23,42,0.06);
      background: linear-gradient(135deg,#8b5cf6,#7c3aed);
      color:#fff;font-size:0.92rem;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 10px 18px rgba(139,92,246,0.25);
    }
    .btn:active{ transform: translateY(0); }
    .btn svg{width:15px;height:15px}

    .btn-cancel{
      background:#f1f5f9;color:#334155;
    }
    .btn-cancel:hover{
      background:#e2e8f0;
      box-shadow:0 8px 12px rgba(15,23,42,0.07);
    }

    .action-btn{
      padding:0.52rem 0.8rem;font-size:0.82rem;border-radius:10px;
      margin:0.18rem 0.12rem;min-width:76px;
    }
    .btn-edit{
      background:linear-gradient(135deg,#8b5cf6,#ec4899);
    }
    .btn-delete{
      background:linear-gradient(135deg,#ef4444,#dc2626);
    }

    .brand-title{
      font-size:1.12rem;font-weight:800;color:var(--primary);
      margin:1.4rem 0 .6rem;padding-bottom:.35rem;border-bottom:3px solid var(--primary);
      letter-spacing:.2px;
    }

    /* ===== Table responsive ===== */
    table{width:100%;border-collapse:separate;border-spacing:0 .6rem}
    th{display:none}
    td{
      display:block;width:100%;padding:.9rem;background:var(--surface);
      border-radius:12px;box-shadow:0 2px 8px rgba(15,23,42,0.05);
      position:relative;padding-left:86px;font-size:0.93rem
    }
    td::before{
      content:attr(data-label);position:absolute;left:.9rem;top:.9rem;font-weight:700;
      color:var(--text-secondary);font-size:0.75rem;text-transform:uppercase;letter-spacing:.06em
    }
    .days{
      font-weight:800;font-size:1rem!important;display:flex;align-items:center;gap:8px;
    }

    /* Status badge */
    .status-pill{
      display:inline-flex;align-items:center;gap:4px;
      padding:3px 7px;border-radius:999px;
      font-size:11px;font-weight:800;letter-spacing:.02em;
      border:1px solid var(--border);
      background:#fff;white-space:nowrap;
    }
    .st-expired{color:#b91c1c;border-color:#fecaca;background:#fff1f2;}
    .st-h1{color:#7c2d12;border-color:#fed7aa;background:#fff7ed;}
    .st-h2{color:#92400e;border-color:#fde68a;background:#fffbeb;}
    .st-h3{color:#b45309;border-color:#fcd34d;background:#fffbeb;}
    .st-soon{color:#1d4ed8;border-color:#bfdbfe;background:#eff6ff;}
    .st-safe{color:#065f46;border-color:#bbf7d0;background:#ecfdf5;}

    /* Trigger button fixed */
    .trigger-fixed{
      position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
      width:92%;max-width:420px;
      background:linear-gradient(135deg,#8b5cf6,#ec4899);
      color:white;padding:0.9rem 1.2rem;border-radius:50px;font-weight:800;
      box-shadow:0 12px 28px rgba(139,92,246,0.35);
      z-index:1000;text-decoration:none;text-align:center;font-size:1rem;
      display:flex;justify-content:center;align-items:center;gap:8px;
      transition:.15s ease;
    }
    .trigger-fixed svg{width:16px;height:16px}
    .trigger-fixed:hover{filter:brightness(1.04);transform:translateX(-50%) translateY(-1px)}

    /* Logs */
    .logs-wrap{
      max-height:360px; overflow:auto; border:1px solid var(--border);
      border-radius:12px; background:var(--surface2);
    }
    .logs{width:100%;border-collapse:collapse;font-size:0.9rem}
    .logs th,.logs td{
      padding:.65rem .8rem;text-align:left;border-bottom:1px solid var(--border);
      background:transparent;
    }
    .logs th{
      position:sticky;top:0;background:var(--surface);
      font-size:.75rem;text-transform:uppercase;letter-spacing:.06em;
      color:var(--text-secondary);font-weight:800;
    }
    .logs th:nth-child(1),.logs td:nth-child(1){
      width:160px;white-space:nowrap;
    }
    .logs th:nth-child(2),.logs td:nth-child(2){
      width:90px;text-align:center;
    }
    .log-pill{
      display:inline-flex;padding:3px 8px;border-radius:999px;font-size:11px;font-weight:800;
      border:1px solid var(--border);background:white;
    }
    .pill-INFO{color:#2563eb;}
    .pill-WARN{color:#b45309;}
    .pill-ERROR{color:#b91c1c;}

    /* ===== Desktop: one row card ===== */
    @media (min-width: 768px){
      .form-grid{grid-template-columns:repeat(4,1fr)}
      .stats-grid{grid-template-columns:repeat(4,1fr);gap:1rem}
      th{
        display:table-cell;padding:0.95rem 1rem;background:var(--surface2);
        color:#0f172a;font-weight:800;font-size:.9rem;
      }
      td{
        display:table-cell;padding:0.95rem 1rem;padding-left:1rem;
      }
      td::before{display:none}
      .trigger-fixed{bottom:26px;right:26px;left:auto;transform:none;width:auto}

      table.subs-table{border-spacing:0 9px;}
      table.subs-table tbody tr{
        background:var(--surface);
        box-shadow:0 6px 14px rgba(15,23,42,0.06);
        border-radius:14px;overflow:hidden;
      }
      table.subs-table td{
        background:transparent!important;box-shadow:none!important;border-bottom:none!important;
        vertical-align:middle;
      }
      table.subs-table td:first-child{
        font-weight:800;color:#0f172a;
      }
      table.subs-table td:last-child{
        white-space:nowrap;
      }
    }

    /* ===== Footer pro ===== */
    .footer{
      margin-top:1.6rem;padding:1.2rem 0 1.6rem;color:var(--text-secondary);font-size:0.9rem;
    }
    .footer-inner{
      background:var(--surface);border:1px solid var(--border);border-radius:16px;
      padding:1rem 1.1rem;display:flex;justify-content:space-between;align-items:center;
      flex-wrap:wrap;gap:10px;box-shadow:0 6px 18px rgba(15,23,42,0.05);
    }
    .footer-brand{display:flex;align-items:center;gap:10px;}
    .footer-logo{
      width:34px;height:34px;border-radius:10px;display:grid;place-items:center;
      background:linear-gradient(135deg,#8b5cf6,#ec4899);color:white;font-weight:900;
      box-shadow:0 8px 14px rgba(139,92,246,.25);font-size:.9rem;
    }
    .footer-title{font-weight:800;color:#0f172a}
    .footer-subtitle{font-size:12px}
    .footer-meta{
      display:flex;gap:6px;align-items:center;flex-wrap:wrap;font-size:12px;font-weight:600;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="top-left">
        <div class="logo">R</div>
        <div class="title-wrap">
          <h1>RDR Hosting Reminder</h1>
          <div class="subtitle">Professional hosting expiration management</div>
        </div>
      </div>
      <div class="top-right">
        <span class="badge">ðŸ‘¤ {{ username }}</span>
        <span class="badge">ðŸ•˜ {{ now.strftime('%d %B %Y - %H:%M WIB') }}</span>
        <a class="logout" href="/logout">
          <!-- logout icon -->
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Logout
        </a>
      </div>
    </div>

    <header>
      <p class="subtitle">
        Total: {{ subs|length }} active subscription{{ 's' if subs|length != 1 else '' }}
      </p>
    </header>

    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value">{{ subs|length }}</div><div class="stat-label">Total</div></div>
      <div class="stat-card"><div class="stat-value">{{ grouped|length }}</div><div class="stat-label">Brands</div></div>
      <div class="stat-card"><div class="stat-value">{{ expiring_soon }}</div><div class="stat-label">Expiring Soon</div></div>
      <div class="stat-card"><div class="stat-value">{{ expired_count }}</div><div class="stat-label">Expired</div></div>
    </div>

    <!-- ADD / EDIT FORM -->
    <div class="card">
      <div class="card-head">
        <h2 id="form-title">Add New Subscription</h2>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          <span class="badge">Timezone: Asia/Jakarta</span>
          <span class="badge">Telegram Alerts: ON</span>
        </div>
      </div>

      <form id="subscription-form" method="post" action="/add">
        <div class="form-grid">
          <input type="text" id="name" name="name" placeholder="Service Name" required>
          <input type="url" id="url" name="url" placeholder="URL" required>
          <input type="text" id="brand" name="brand" placeholder="Brand Domain (contoh: RADAR138, K39, USR)" required>
          <input type="text" id="expires_at" name="expires_at" placeholder="Expire Date (mm/dd/yyyy)" required>
        </div>
        <div style="display:flex;gap:.6rem;flex-wrap:wrap">
          <button type="submit" class="btn">
            <!-- save icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Subscription
          </button>
          <button type="button" class="btn btn-cancel" onclick="resetForm()">
            <!-- x icon -->
            <svg viewBox="0 0 24 24" fill="none" stroke="#334155" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            Cancel Edit
          </button>
        </div>
      </form>
    </div>

    <!-- ACTIVE SUBS -->
    <div class="card">
      <div class="card-head">
        <h2>Active Subscriptions</h2>
        <input id="search" type="text" placeholder="Search service / brand..." style="max-width:240px">
      </div>

      {% if subs %}
        {% for brand, items in grouped.items() %}
          <div class="brand-title">{{ brand or "No Brand" }}</div>

          <table class="subs-table">
            <thead>
              <tr>
                <th>No</th>
                <th>Service</th>
                <th>Brand</th>
                <th>URL</th>
                <th>Expire Date</th>
                <th>Days Left</th>
                <th>Action</th>
              </tr>
            </thead>

            <tbody>
              {% for sub in items %}
                {% set days = (sub.expires_at - today).days %}
                <tr class="row">
                  <td data-label="No">{{ loop.index }}</td>

                  <td data-label="Service">
                    <strong>{{ sub.name }}</strong>
                  </td>

                  <td data-label="Brand">
                    <strong>{{ sub.brand or "â€“" }}</strong>
                  </td>

                  <td data-label="URL">
                    <a href="{{ sub.url }}" target="_blank" style="color:var(--primary);font-weight:650">
                      {{ sub.url }}
                    </a>
                  </td>

                  <td data-label="Expire">
                    {{ sub.expires_at.strftime('%d %B %Y') }}
                  </td>

                  <td data-label="Days Left" class="days"
                      style="color:
                        {% if days <= 3 %}var(--danger)
                        {% elif days <= 7 %}var(--warning)
                        {% else %}var(--success)
                        {% endif %}">
                    {{ days }} day{{ '' if days == 1 else 's' }}

                    {# ===== status badge ===== #}
                    {% if days < 0 %}
                      <span class="status-pill st-expired">EXPIRED</span>
                    {% elif days == 0 %}
                      <span class="status-pill st-expired">DUE TODAY</span>
                    {% elif days == 1 %}
                      <span class="status-pill st-h1">H-1</span>
                    {% elif days == 2 %}
                      <span class="status-pill st-h2">H-2</span>
                    {% elif days == 3 %}
                      <span class="status-pill st-h3">H-3</span>
                    {% elif days <= 7 %}
                      <span class="status-pill st-soon">SOON</span>
                    {% else %}
                      <span class="status-pill st-safe">SAFE</span>
                    {% endif %}
                  </td>

                  <td data-label="Action">
                    <button class="btn action-btn btn-edit"
                      onclick='editSubscription({{ sub.id }}, "{{ sub.name|e }}", "{{ sub.url }}", "{{ sub.brand or ""|e }}", "{{ sub.expires_at.strftime("%m/%d/%Y") }}")'>
                      <!-- edit icon -->
                      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                        <path d="M12 20h9"/>
                        <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
                      </svg>
                      Edit
                    </button>

                    <form method="post" action="/delete/{{ sub.id }}" style="display:inline">
                      <button type="submit" class="btn action-btn btn-delete"
                        onclick="return confirm('Delete this subscription?')">
                        <!-- trash icon -->
                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                          <polyline points="3 6 5 6 21 6"/>
                          <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                          <path d="M10 11v6"/>
                          <path d="M14 11v6"/>
                          <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
                        </svg>
                        Delete
                      </button>
                    </form>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endfor %}
      {% else %}
        <p style="text-align:center;color:var(--text-secondary);padding:3.2rem 0">
          No active subscriptions yet. Add your first one above.
        </p>
      {% endif %}
    </div>

    <!-- LOGS -->
    <div class="card">
      <div class="card-head">
        <h2>Logs Terbaru</h2>
        <span class="badge">Last 200 events</span>
      </div>

      {% if logs %}
        <div class="logs-wrap">
          <table class="logs">
            <thead>
              <tr>
                <th>Waktu</th>
                <th>Level</th>
                <th>Pesan</th>
              </tr>
            </thead>
            <tbody>
              {% for log in logs %}
                <tr>
                  <td>{{ log.created_at.strftime('%d %b %Y %H:%M') }}</td>
                  <td><span class="log-pill pill-{{ log.level }}">{{ log.level }}</span></td>
                  <td>{{ log.message }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p style="color:var(--text-secondary)">Belum ada logs.</p>
      {% endif %}
    </div>

    <a href="/trigger" class="trigger-fixed">
      <!-- send icon -->
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
        <line x1="22" y1="2" x2="11" y2="13"/>
        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
      Send List to Telegram
    </a>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer-inner">
        <div class="footer-brand">
          <div class="footer-logo">R</div>
          <div>
            <div class="footer-title">RDR Hosting Reminder</div>
            <div class="footer-subtitle">Monitoring & reminder system</div>
          </div>
        </div>

        <div class="footer-meta">
          <span>Timezone: Asia/Jakarta</span>
          <span>â€¢</span>
          <span>Telegram Alerts Active</span>
          <span>â€¢</span>
          <span>Build: 03 Dec 2025</span>
        </div>
      </div>
    </footer>

  </div>

  <script>
    function editSubscription(id, name, url, brand, expires_at){
      document.getElementById('form-title').innerText = 'Edit Subscription';
      document.getElementById('name').value = name;
      document.getElementById('url').value = url;
      document.getElementById('brand').value = brand;
      document.getElementById('expires_at').value = expires_at;
      document.getElementById('subscription-form').action = `/update/${id}`;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function resetForm(){
      document.getElementById('form-title').innerText='Add New Subscription';
      document.getElementById('subscription-form').reset();
      document.getElementById('subscription-form').action='/add';
    }

    const search = document.getElementById("search");
    if(search){
      search.addEventListener("input", () => {
        const q = search.value.toLowerCase();
        document.querySelectorAll(".row").forEach(r => {
          r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none";
        });
      });
    }
  </script>
</body>
</html>
