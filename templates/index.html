<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>RDR HOSTING REMINDER</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');
        body {font-family: 'Segoe UI', sans-serif; background: #000; color: #0f0; margin:0; padding:20px;}
        h1 {font-family: 'Orbitron'; color: #ff0066; text-align:center; font-size:3em; text-shadow: 0 0 20px #ff0066;}
        .container {max-width:1000px; margin:auto; background:#111; padding:20px; border-radius:15px; box-shadow:0 0 30px #ff0066;}
        input, button {padding:12px; margin:5px; border:none; border-radius:8px; font-size:16px;}
        input {background:#222; color:#0f0; width:100%; box-sizing:border-box;}
        button {background:#ff0066; color:white; cursor:pointer; font-weight:bold;}
        button:hover {background:#ff3399;}
        table {width:100%; border-collapse:collapse; margin:30px 0;}
        th {background:#ff0066; color:white; padding:15px;}
        td {padding:15px; border-bottom:1px solid #333;}
        .expired {color:#ff0000; font-weight:bold; animation:blink 1s infinite;}
        .critical {color:#ff0066; font-weight:bold;}
        .warning {color:#ffaa00;}
        .safe {color:#00ff00;}
        @keyframes blink {50% {opacity:0;}}
        .trigger {background:#00ff00; color:black; padding:20px; font-size:18px; position:fixed; bottom:20px; right:20px; border-radius:50px; box-shadow:0 0 20px #00ff00;}
    </style>
</head>
<body>
<div class="container">
    <h1>Hosting Reminder</h1>
    <p style="text-align:center;color:#ffaa00">Total: {{ subs|length }} subscription | {{ now.strftime('%d %B %Y %H:%M:%S WIB') }}</p>

    <h2 style="color:#ff0066">Add / Update Subscription</h2>
    <form method="post" action="/add">
        <input name="name" placeholder="Name (contoh: Netflix)" required>
        <input name="url" placeholder="URL[](https://...)" required>
        <input name="brand" placeholder="Brand (contoh: RADAR138)">
        <input name="expires_at" placeholder="mm/dd/yyyy" required>
        <button type="submit">+ ADD NEW</button>
    </form>

    <h2 style="color:#ff0066">Your Subscriptions</h2>
    {% if subs %}
        {% set grouped = {} %}
        {% for sub in subs %}
            {% set brand = sub.brand or 'Tanpa Brand' %}
            {% if brand = brand.upper() %}
            {% if grouped.update({brand: grouped.get(brand, []) + [sub]}) %} {% endif %}
        {% endfor %}

        {% for brand in grouped|dictsort %}
            <h3 style="color:#ff3399; margin-top:30px">{{ brand[0] }}</h3>
            <table>
                <tr><th>No</th><th>Name</th><th>URL</th><th>Expire</th><th>Days Left</th><th>Action</th></tr>
                {% for sub in grouped[brand] %}
                    {% set days = (sub.expires_at - today).days %}
                    <tr>
                        <td>{{ loop.index }}</td>
                        <td><b>{{ sub.name }}</b></td>
                        <td><a href="{{ sub.url }}" target="_blank">{{ sub.url }}</a></td>
                        <td>{{ sub.expires_at.strftime('%d %B %Y') }}</td>
                        <td class="{% if days <= 0 %}expired{% elif days <= 3 %}critical{% elif days <= 7 %}warning{% else %}safe{% endif %}">
                            {{ days }} hari lagi
                        </td>
                        <td>
                            <form method="post" action="/delete/{{ sub.id }}" style="display:inline" onsubmit="return confirm('Yakin hapus?')">
                                <button type="submit" style="background:#ff0000">Delete</button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        {% endfor %}
    {% else %}
        <p style="color:orange;text-align:center">Belum ada subscription bro. Tambah yang pertama! ðŸš€</p>
    {% endif %}

    <a href="/trigger"><button class="trigger">âš¡ TRIGGER FULL LIST KE TELEGRAM</button></a>
</div>
</body>
</html>
