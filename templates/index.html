<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RDR Hosting Reminder</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#f6f7fb;
      --surface:#ffffff;
      --surface2:#f1f5f9;
      --text:#0f172a;
      --text-secondary:#64748b;
      --primary:#7c3aed;
      --primary-2:#8b5cf6;
      --success:#10b981;
      --warning:#f59e0b;
      --danger:#ef4444;
      --border:#e5e7eb;
      --radius:14px;
      --radius-lg:18px;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Inter',sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.55;
      min-height:100vh;
      padding-bottom:110px;
    }
    .container{max-width:1240px;margin:0 auto;padding:1.1rem 1rem}

    /* ===== Topbar ===== */
    .topbar{
      display:flex;align-items:center;justify-content:space-between;
      gap:12px;
      background:rgba(255,255,255,0.9);
      border:1px solid var(--border);
      border-radius:16px;
      padding:0.7rem 0.9rem;
      box-shadow:0 6px 18px rgba(15,23,42,0.06);
      position:sticky; top:10px; z-index:50;
      backdrop-filter: blur(6px);
    }
    .top-left{display:flex;align-items:center;gap:10px}
    .logo{
      width:38px;height:38px;border-radius:12px;display:grid;place-items:center;
      background:linear-gradient(135deg,#7c3aed,#ec4899);
      color:white;font-weight:800;
      box-shadow:0 8px 18px rgba(124,58,237,.28);
      font-size:1rem;
    }
    .title-wrap h1{
      font-size:1.18rem;font-weight:800;line-height:1.1;
      letter-spacing:.2px;
    }
    .title-wrap .subtitle{
      font-size:0.8rem;color:var(--text-secondary);
      margin-top:2px;
    }

    .top-right{display:flex;align-items:center;gap:6px;flex-wrap:wrap}
    .badge{
      display:inline-flex;align-items:center;gap:6px;
      background:var(--surface2);
      border:1px solid var(--border);
      padding:6px 10px;border-radius:999px;font-size:12px;font-weight:700;
      color:#334155;
      white-space:nowrap;
      cursor:default;
    }
    .logout{
      background:linear-gradient(135deg,#ef4444,#dc2626);
      color:white;border:none;cursor:pointer;
      padding:7px 10px;border-radius:11px;font-weight:800;font-size:12px;
      text-decoration:none;
      transition:.12s ease;
      display:inline-flex;align-items:center;gap:6px;
      box-shadow:0 8px 14px rgba(239,68,68,.18);
      white-space:nowrap;
    }
    .logout:hover{filter:brightness(1.05);transform:translateY(-1px)}

    header{text-align:center;margin:1.2rem 0 0.9rem}
    header .subtitle{color:var(--text-secondary);font-size:0.92rem;margin-top:4px}

    /* ===== Stats ===== */
    .stats-grid{
      display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));
      gap:.8rem;margin:1rem 0 1.4rem;
    }
    .stat-card{
      background:var(--surface);border-radius:14px;padding:0.95rem .9rem;
      border:1px solid var(--border);box-shadow:0 3px 12px rgba(15,23,42,0.05);
      text-align:center;
    }
    .stat-value{font-size:1.9rem;font-weight:800;color:var(--primary)}
    .stat-label{color:var(--text-secondary);font-size:0.82rem;margin-top:0.25rem;font-weight:600}

    /* ===== Card ===== */
    .card{
      background:var(--surface);
      border-radius:var(--radius-lg);
      padding:1.1rem 1.1rem;
      margin-bottom:1rem;
      border:1px solid var(--border);
      box-shadow:0 4px 16px rgba(15,23,42,0.05);
    }
    .card-head{
      display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap;
      margin-bottom:.8rem;
    }
    .card-head h2{font-size:1.05rem;font-weight:800;letter-spacing:.2px}

    /* ===== Form ===== */
    .form-grid{
      display:grid;grid-template-columns:1fr;gap:.7rem;margin-bottom:.9rem
    }
    input{
      width:100%;padding:0.78rem 0.85rem;background:#fff;border:1px solid var(--border);
      border-radius:12px;font-size:0.95rem;
      font-weight:600;color:var(--text);
    }
    input::placeholder{font-weight:500;color:#94a3b8}
    input:focus{
      outline:none;border-color:var(--primary);
      box-shadow:0 0 0 4px rgba(124,58,237,0.12)
    }
    input[type="date"]{font-weight:700}

    /* ===== Buttons ===== */
    .btn{
      appearance:none;border:none;cursor:pointer;
      font-weight:800;letter-spacing:.2px;
      padding:0.68rem 1rem;border-radius:11px;
      transition:.15s ease;
      display:inline-flex;align-items:center;justify-content:center;gap:7px;
      box-shadow:0 6px 14px rgba(15,23,42,0.06);
      background: linear-gradient(135deg,#7c3aed,#8b5cf6);
      color:#fff;font-size:0.92rem;
      white-space:nowrap;
    }
    .btn:hover{
      transform: translateY(-1px);
      filter: brightness(1.03);
      box-shadow: 0 10px 18px rgba(124,58,237,0.25);
    }
    .btn:active{ transform: translateY(0); }
    .btn svg{width:15px;height:15px}

    .btn-ghost{
      background:#f1f5f9;color:#334155;
      box-shadow:none;border:1px solid var(--border);
    }
    .btn-ghost:hover{background:#e2e8f0}

    .action-btn{
      padding:0.5rem 0.75rem;font-size:0.82rem;border-radius:10px;
      margin:0.12rem 0.12rem;min-width:74px;
      box-shadow:none;
    }
    .btn-edit{background:linear-gradient(135deg,#7c3aed,#ec4899);}
    .btn-delete{background:linear-gradient(135deg,#ef4444,#dc2626);}
    .btn-extend{background:#10b981;color:white;}
    .btn-extend:hover{filter:brightness(1.03);box-shadow:0 8px 12px rgba(16,185,129,.25)}

    /* ===== Brand block ===== */
    .brand-title{
      font-size:1.05rem;font-weight:900;color:#0f172a;
      margin:1.2rem 0 .5rem;
      display:flex;align-items:center;justify-content:space-between;
    }
    .brand-line{
      height:2px;flex:1;margin-left:10px;background:linear-gradient(90deg,var(--primary),transparent);
      border-radius:999px;
    }

    /* ===== Filter segmented control ===== */
    .filters{
      display:flex;gap:6px;flex-wrap:wrap;
      background:#f8fafc;border:1px solid var(--border);
      padding:6px;border-radius:999px;
    }
    .filter-btn{
      border:none;cursor:pointer;
      padding:6px 10px;border-radius:999px;
      font-size:12px;font-weight:800;
      color:#475569;background:transparent;
      transition:.12s ease;
      white-space:nowrap;
    }
    .filter-btn.active{
      background:#0f172a;color:white;box-shadow:0 4px 10px rgba(15,23,42,.18);
    }
    .filter-btn:not(.active):hover{background:#eef2f7}

    /* ===== Table ===== */
    table.subs-table{
      width:100%;
      border-collapse:separate;
      border-spacing:0 8px;
    }
    table.subs-table thead th{
      padding:0.75rem 0.9rem;
      background:linear-gradient(#f8fafc,#f1f5f9);
      border-top:1px solid var(--border);
      border-bottom:1px solid var(--border);
      font-size:0.75rem;font-weight:900;
      text-transform:uppercase;letter-spacing:.08em;
      color:#0f172a;
    }
    table.subs-table thead th:first-child{
      border-left:1px solid var(--border);
      border-radius:12px 0 0 12px;
    }
    table.subs-table thead th:last-child{
      border-right:1px solid var(--border);
      border-radius:0 12px 12px 0;
    }

    table.subs-table tbody tr{
      background:var(--surface);
      box-shadow:0 8px 18px rgba(15,23,42,0.06);
      border-radius:14px;overflow:hidden;
      transition:.12s ease;
    }
    table.subs-table tbody tr:hover{
      transform:translateY(-1px);
      box-shadow:0 12px 24px rgba(15,23,42,0.08);
    }
    table.subs-table td{
      padding:0.9rem 0.9rem;
      vertical-align:middle;font-size:0.95rem;border:none !important;
    }
    table.subs-table td:first-child{font-weight:900;width:64px;}

    td[data-label="Service"] strong{font-size:1rem;font-weight:800}
    td[data-label="Brand"] strong{
      display:inline-flex;padding:4px 8px;border-radius:999px;
      background:#f8fafc;border:1px solid var(--border);
      font-size:0.78rem;font-weight:900;color:#0f172a;letter-spacing:.3px;
    }
    td[data-label="URL"] a{
      color:#6d28d9 !important;font-weight:700 !important;text-decoration:none;
      border-bottom:1px dashed rgba(109,40,217,.35);
      word-break:break-all;
    }
    td[data-label="URL"] a:hover{border-bottom-style:solid;opacity:.9}

    td[data-label="Expire"]{font-weight:700}

    .days{
      font-weight:900;font-size:1.02rem !important;
      display:flex;align-items:center;gap:8px;white-space:nowrap;
    }
    .days .num{font-size:1.15rem}

    .status-pill{
      display:inline-flex;align-items:center;gap:6px;
      padding:4px 9px;border-radius:999px;font-size:11px;font-weight:900;
      letter-spacing:.08em;border:1px solid transparent;background:#fff;
      box-shadow: inset 0 0 0 1px var(--border);
      white-space:nowrap;
    }
    .st-expired{ color:#b91c1c; background:#fff1f2; box-shadow: inset 0 0 0 1px #fecaca; }
    .st-h1{ color:#7c2d12; background:#fff7ed; box-shadow: inset 0 0 0 1px #fed7aa; }
    .st-h2{ color:#92400e; background:#fffbeb; box-shadow: inset 0 0 0 1px #fde68a; }
    .st-h3{ color:#b45309; background:#fffbeb; box-shadow: inset 0 0 0 1px #fcd34d; }
    .st-soon{ color:#1d4ed8; background:#eff6ff; box-shadow: inset 0 0 0 1px #bfdbfe; }
    .st-safe{ color:#065f46; background:#ecfdf5; box-shadow: inset 0 0 0 1px #bbf7d0; }

    .actions{
      display:flex;align-items:center;justify-content:flex-end;gap:6px;flex-wrap:wrap;
    }

    /* ===== Trigger floating ===== */
    .trigger-fixed{
      position:fixed;bottom:18px;left:50%;transform:translateX(-50%);
      width:92%;max-width:420px;
      background:linear-gradient(135deg,#7c3aed,#ec4899);
      color:white;padding:0.9rem 1.2rem;border-radius:50px;font-weight:900;
      box-shadow:0 12px 28px rgba(124,58,237,0.35);
      z-index:1000;text-decoration:none;text-align:center;font-size:0.98rem;
      display:flex;justify-content:center;align-items:center;gap:8px;
      transition:.15s ease;
    }
    .trigger-fixed svg{width:16px;height:16px}
    .trigger-fixed:hover{filter:brightness(1.04);transform:translateX(-50%) translateY(-1px)}

    /* ===== Logs ===== */
    .logs-wrap{
      max-height:360px; overflow:auto; border:1px solid var(--border);
      border-radius:12px; background:var(--surface2);
    }
    .logs{width:100%;border-collapse:collapse;font-size:0.9rem}
    .logs th,.logs td{
      padding:.6rem .8rem;text-align:left;border-bottom:1px solid var(--border);
      background:transparent;
    }
    .logs th{
      position:sticky;top:0;background:var(--surface);
      font-size:.72rem;text-transform:uppercase;letter-spacing:.06em;
      color:var(--text-secondary);font-weight:900;
    }
    .logs th:nth-child(1),.logs td:nth-child(1){width:165px;white-space:nowrap}
    .logs th:nth-child(2),.logs td:nth-child(2){width:95px;text-align:center}
    .log-pill{
      display:inline-flex;padding:3px 8px;border-radius:999px;font-size:11px;font-weight:900;
      border:1px solid var(--border);background:white;
    }
    .pill-INFO{color:#2563eb;}
    .pill-WARN{color:#b45309;}
    .pill-ERROR{color:#b91c1c;}

    /* ===== Desktop ===== */
    @media (min-width: 768px){
      .form-grid{grid-template-columns:repeat(4,1fr)}
      .stats-grid{grid-template-columns:repeat(4,1fr);gap:1rem}
      .trigger-fixed{bottom:26px;right:26px;left:auto;transform:none;width:auto}
      table.subs-table{border-spacing:0 8px;}
    }

    /* ===== Footer ===== */
    .footer{margin-top:1.4rem;padding:1rem 0 1.6rem;color:var(--text-secondary);font-size:0.9rem;}
    .footer-inner{
      background:var(--surface);border:1px solid var(--border);border-radius:16px;
      padding:0.95rem 1.05rem;display:flex;justify-content:space-between;align-items:center;
      flex-wrap:wrap;gap:10px;box-shadow:0 6px 18px rgba(15,23,42,0.05);
    }
    .footer-brand{display:flex;align-items:center;gap:10px;}
    .footer-logo{
      width:34px;height:34px;border-radius:10px;display:grid;place-items:center;
      background:linear-gradient(135deg,#7c3aed,#ec4899);color:white;font-weight:900;
      box-shadow:0 8px 14px rgba(124,58,237,.25);font-size:.9rem;
    }
    .footer-title{font-weight:900;color:#0f172a}
    .footer-subtitle{font-size:12px}
    .footer-meta{
      display:flex;gap:6px;align-items:center;flex-wrap:wrap;
      font-size:12px;font-weight:700;
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="top-left">
        <div class="logo">R</div>
        <div class="title-wrap">
          <h1>RDR Hosting Reminder</h1>
          <div class="subtitle">Hosting expiration management</div>
        </div>
      </div>
      <div class="top-right">
        <span class="badge">ðŸ‘¤ {{ username }}</span>
        <span class="badge">ðŸ•˜ {{ now.strftime('%d %B %Y - %H:%M WIB') }}</span>
        <a class="logout" href="/logout">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
            <polyline points="16 17 21 12 16 7"/>
            <line x1="21" y1="12" x2="9" y2="12"/>
          </svg>
          Logout
        </a>
      </div>
    </div>

    <header>
      <p class="subtitle">
        Total: {{ subs|length }} active subscription{{ 's' if subs|length != 1 else '' }}
      </p>
    </header>

    <!-- STATS -->
    <div class="stats-grid">
      <div class="stat-card"><div class="stat-value">{{ subs|length }}</div><div class="stat-label">Total</div></div>
      <div class="stat-card"><div class="stat-value">{{ grouped|length }}</div><div class="stat-label">Brands</div></div>
      <div class="stat-card"><div class="stat-value">{{ expiring_soon }}</div><div class="stat-label">Expiring Soon</div></div>
      <div class="stat-card"><div class="stat-value">{{ expired_count }}</div><div class="stat-label">Expired</div></div>
    </div>

    <!-- ADD / EDIT FORM -->
    <div class="card">
      <div class="card-head">
        <h2 id="form-title">Add New Subscription</h2>
        <div style="display:flex;gap:6px;flex-wrap:wrap">
          <span class="badge">Timezone: Asia/Jakarta</span>
          <span class="badge">Telegram Alerts: ON</span>
        </div>
      </div>

      <form id="subscription-form" method="post" action="/add">
        <div class="form-grid">
          <input type="text" id="name" name="name" placeholder="Service Name" required>
          <input type="url" id="url" name="url" placeholder="URL" required>
          <input type="text" id="brand" name="brand" placeholder="Brand Domain (contoh: RADAR138, K39, USR)" required>

          <!-- date picker -->
          <input type="date" id="expires_at_picker" required>
          <!-- hidden sent to backend (mm/dd/yyyy) -->
          <input type="hidden" id="expires_at" name="expires_at" required>
        </div>

        <!-- quick add -->
        <div style="display:flex;gap:6px;flex-wrap:wrap;margin:-4px 0 10px">
          <button type="button" class="badge" onclick="quickAddDays(7)">+7 days</button>
          <button type="button" class="badge" onclick="quickAddDays(14)">+14 days</button>
          <button type="button" class="badge" onclick="quickAddDays(30)">+30 days</button>
          <button type="button" class="badge" onclick="quickAddDays(365)">+1 year</button>
        </div>

        <div style="display:flex;gap:.6rem;flex-wrap:wrap">
          <button type="submit" class="btn">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
              <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              <polyline points="17 21 17 13 7 13 7 21"/>
              <polyline points="7 3 7 8 15 8"/>
            </svg>
            Save Subscription
          </button>
          <button type="button" class="btn btn-ghost" onclick="resetForm()">
            <svg viewBox="0 0 24 24" fill="none" stroke="#334155" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
            Cancel Edit
          </button>
        </div>
      </form>
    </div>

    <!-- ACTIVE SUBS -->
    <div class="card">
      <div class="card-head">
        <h2>Active Subscriptions</h2>

        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <input id="search" type="text" placeholder="Search service / brand..." style="max-width:230px">
          <div class="filters" id="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="safe">Safe</button>
            <button class="filter-btn" data-filter="soon">Soon â‰¤7</button>
            <button class="filter-btn" data-filter="h3">H-3</button>
            <button class="filter-btn" data-filter="h2">H-2</button>
            <button class="filter-btn" data-filter="h1">H-1/Today</button>
            <button class="filter-btn" data-filter="expired">Expired</button>
          </div>
        </div>
      </div>

      {% if subs %}
        {% for brand, items in grouped.items() %}
          <div class="brand-title">
            <span>{{ brand or "No Brand" }}</span>
            <span class="brand-line"></span>
            <span style="font-size:12px;color:var(--text-secondary);font-weight:800;">
              {{ items|length }} items
            </span>
          </div>

          <table class="subs-table">
            <thead>
              <tr>
                <th>No</th>
                <th>Service</th>
                <th>Brand</th>
                <th>URL</th>
                <th>Expire Date</th>
                <th>Days Left</th>
                <th>Action</th>
              </tr>
            </thead>

            <tbody>
              {% for sub in items %}
                {% set days = (sub.expires_at - today).days %}
                <tr class="row" data-days="{{ days }}">
                  <td data-label="No">{{ loop.index }}</td>

                  <td data-label="Service">
                    <strong>{{ sub.name }}</strong>
                  </td>

                  <td data-label="Brand">
                    <strong>{{ sub.brand or "â€“" }}</strong>
                  </td>

                  <td data-label="URL">
                    <a href="{{ sub.url }}" target="_blank">{{ sub.url }}</a>
                  </td>

                  <td data-label="Expire">
                    {{ sub.expires_at.strftime('%d %B %Y') }}
                  </td>

                  <td data-label="Days Left" class="days"
                      style="color:
                        {% if days <= 3 %}var(--danger)
                        {% elif days <= 7 %}var(--warning)
                        {% else %}var(--success)
                        {% endif %}">
                    <span class="num">{{ days }}</span>
                    <span>{{ 'day' if days == 1 else 'days' }}</span>

                    {% if days < 0 %}
                      <span class="status-pill st-expired">EXPIRED</span>
                    {% elif days == 0 %}
                      <span class="status-pill st-expired">DUE TODAY</span>
                    {% elif days == 1 %}
                      <span class="status-pill st-h1">H-1</span>
                    {% elif days == 2 %}
                      <span class="status-pill st-h2">H-2</span>
                    {% elif days == 3 %}
                      <span class="status-pill st-h3">H-3</span>
                    {% elif days <= 7 %}
                      <span class="status-pill st-soon">SOON</span>
                    {% else %}
                      <span class="status-pill st-safe">SAFE</span>
                    {% endif %}
                  </td>

                  <td data-label="Action">
                    <div class="actions">
                      <button class="btn action-btn btn-edit"
                        onclick='editSubscription({{ sub.id }}, "{{ sub.name|e }}", "{{ sub.url }}", "{{ sub.brand or ""|e }}", "{{ sub.expires_at.strftime("%m/%d/%Y") }}")'>
                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                          <path d="M12 20h9"/>
                          <path d="M16.5 3.5a2.1 2.1 0 0 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
                        </svg>
                        Edit
                      </button>

                      <button type="button" class="btn action-btn btn-extend"
                        onclick='extendDays({{ sub.id }}, "{{ sub.expires_at.strftime("%m/%d/%Y") }}", 30)'>
                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                          <path d="M12 5v14M5 12h14"/>
                        </svg>
                        +30d
                      </button>

                      <button type="button" class="btn action-btn btn-extend"
                        onclick='extendDays({{ sub.id }}, "{{ sub.expires_at.strftime("%m/%d/%Y") }}", 365)'>
                        <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                          <path d="M12 5v14M5 12h14"/>
                        </svg>
                        +1y
                      </button>

                      <form method="post" action="/delete/{{ sub.id }}" style="display:inline">
                        <button type="submit" class="btn action-btn btn-delete"
                          onclick="return confirm('Delete this subscription?')">
                          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/>
                            <path d="M10 11v6"/>
                            <path d="M14 11v6"/>
                            <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/>
                          </svg>
                          Delete
                        </button>
                      </form>
                    </div>
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endfor %}
      {% else %}
        <p style="text-align:center;color:var(--text-secondary);padding:3rem 0">
          No active subscriptions yet. Add your first one above.
        </p>
      {% endif %}
    </div>

    <!-- LOGS -->
    <div class="card">
      <div class="card-head">
        <h2>Logs Terbaru</h2>
        <span class="badge">Last 200 events</span>
      </div>

      {% if logs %}
        <div class="logs-wrap">
          <table class="logs">
            <thead>
              <tr>
                <th>Waktu</th>
                <th>Level</th>
                <th>Pesan</th>
              </tr>
            </thead>
            <tbody>
              {% for log in logs %}
                <tr>
                  <td>{{ log.created_at.strftime('%d %b %Y %H:%M') }}</td>
                  <td><span class="log-pill pill-{{ log.level }}">{{ log.level }}</span></td>
                  <td>{{ log.message }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p style="color:var(--text-secondary)">Belum ada logs.</p>
      {% endif %}
    </div>

    <!-- Trigger -->
    <a href="/trigger" class="trigger-fixed">
      <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
        <line x1="22" y1="2" x2="11" y2="13"/>
        <polygon points="22 2 15 22 11 13 2 9 22 2"/>
      </svg>
      Send List to Telegram
    </a>

    <!-- FOOTER -->
    <footer class="footer">
      <div class="footer-inner">
        <div class="footer-brand">
          <div class="footer-logo">R</div>
          <div>
            <div class="footer-title">RDR Hosting Reminder</div>
            <div class="footer-subtitle">Monitoring & reminder system</div>
          </div>
        </div>

        <div class="footer-meta">
          <span>Timezone: Asia/Jakarta</span>
          <span>â€¢</span>
          <span>Telegram Alerts Active</span>
          <span>â€¢</span>
          <span>Build: 03 Dec 2025</span>
        </div>
      </div>
    </footer>

  </div>

  <script>
    const picker = document.getElementById("expires_at_picker");
    const hidden = document.getElementById("expires_at");

    function toMMDDYYYY(iso){
      if(!iso) return "";
      const [y,m,d] = iso.split("-");
      return `${m}/${d}/${y}`;
    }
    function toISO(mmddyyyy){
      if(!mmddyyyy) return "";
      const [m,d,y] = mmddyyyy.split("/");
      return `${y}-${m.padStart(2,"0")}-${d.padStart(2,"0")}`;
    }

    picker.addEventListener("change", () => {
      hidden.value = toMMDDYYYY(picker.value);
    });

    function quickAddDays(n){
      const now = new Date();
      now.setDate(now.getDate() + n);
      const iso = now.toISOString().slice(0,10);
      picker.value = iso;
      hidden.value = toMMDDYYYY(iso);
    }

    function editSubscription(id, name, url, brand, expires_at){
      document.getElementById('form-title').innerText = 'Edit Subscription';
      document.getElementById('name').value = name;
      document.getElementById('url').value = url;
      document.getElementById('brand').value = brand;

      picker.value = toISO(expires_at);
      hidden.value = expires_at;

      document.getElementById('subscription-form').action = `/update/${id}`;
      window.scrollTo({top:0,behavior:'smooth'});
    }

    function resetForm(){
      document.getElementById('form-title').innerText='Add New Subscription';
      document.getElementById('subscription-form').reset();
      picker.value = "";
      hidden.value = "";
      document.getElementById('subscription-form').action='/add';
    }

    // Extend helper (no timedelta in Jinja)
    function extendDays(id, currentMMDDYYYY, plusDays){
      const [m,d,y] = currentMMDDYYYY.split("/").map(Number);
      const dt = new Date(y, m-1, d);
      dt.setDate(dt.getDate() + plusDays);
      const iso = dt.toISOString().slice(0,10);
      const newMMDDYYYY = toMMDDYYYY(iso);

      // post hidden form to update endpoint
      const form = document.createElement("form");
      form.method = "post";
      form.action = `/update/${id}`;
      form.innerHTML = `
        <input type="hidden" name="name" value="">
        <input type="hidden" name="url" value="">
        <input type="hidden" name="brand" value="">
        <input type="hidden" name="expires_at" value="${newMMDDYYYY}">
      `;
      document.body.appendChild(form);
      form.submit();
    }

    // search
    const search = document.getElementById("search");
    if(search){
      search.addEventListener("input", () => {
        const q = search.value.toLowerCase();
        document.querySelectorAll(".row").forEach(r => {
          r.style.display = r.innerText.toLowerCase().includes(q) ? "" : "none";
        });
      });
    }

    // filters by days-left
    const filters = document.getElementById("filters");
    if(filters){
      filters.addEventListener("click", (e) => {
        const btn = e.target.closest(".filter-btn");
        if(!btn) return;
        const f = btn.dataset.filter;

        document.querySelectorAll(".filter-btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");

        document.querySelectorAll(".row").forEach(row => {
          const days = parseInt(row.dataset.days || "999", 10);
          let show = true;

          switch(f){
            case "expired": show = days < 0; break;
            case "h1": show = days <= 1 && days >= 0; break;
            case "h2": show = days === 2; break;
            case "h3": show = days === 3; break;
            case "soon": show = days <= 7 && days >= 0; break;
            case "safe": show = days > 7; break;
            default: show = true;
          }
          row.style.display = show ? "" : "none";
        });
      });
    }
  </script>
</body>
</html>
